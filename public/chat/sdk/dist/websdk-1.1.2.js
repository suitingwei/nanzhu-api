!function(e){function t(n){if(o[n])return o[n].exports;var i=o[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var o={};return t.m=e,t.c=o,t.p="../../../chat",t(0)}({0:function(module,exports,__webpack_require__){"use strict";!function(window,undefined){var _version="1.1.2",_code=__webpack_require__(196).code,_utils=__webpack_require__(197).utils,_msg=__webpack_require__(198),_message=_msg._msg,_msgHash={};window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.XDomainRequest&&(XDomainRequest.prototype.oldsend=XDomainRequest.prototype.send,XDomainRequest.prototype.send=function(){XDomainRequest.prototype.oldsend.apply(this,arguments),this.readyState=2}),Strophe.Request.prototype._newXHR=function(){var e=_utils.xmlrequest(!0);return e.overrideMimeType&&e.overrideMimeType("text/xml"),e.onreadystatechange=this.func.stropheBind(null,this),e},Strophe.Websocket.prototype._closeSocket=function(){var e=this;e.socket?setTimeout(function(){try{e.socket.close()}catch(e){}},0):e.socket=null};var _networkSt,_listenNetwork=function(e,t){window.addEventListener?(window.addEventListener("online",e),window.addEventListener("offline",t)):window.attachEvent&&(document.body?(document.body.attachEvent("onoffline",t),document.body.attachEvent("onoffline",t)):window.attachEvent("load",function(){document.body.attachEvent("onoffline",t),document.body.attachEvent("onoffline",t)}))},_parseRoom=function(e){var t=[],o=e.getElementsByTagName("item");if(o)for(var n=0;n<o.length;n++){var i=o[n],s=i.getAttribute("jid"),r=s.split("@")[0],a={jid:s,name:i.getAttribute("name"),roomId:r.split("_")[1]};t.push(a)}return t},_parseRoomOccupants=function(e){var t=[],o=e.getElementsByTagName("item");if(o)for(var n=0;n<o.length;n++){var i=o[n],s={jid:i.getAttribute("jid"),name:i.getAttribute("name")};t.push(s)}return t},_parseResponseMessage=function _parseResponseMessage(msginfo){var parseMsgData={errorMsg:!0,data:[]},msgBodies=msginfo.getElementsByTagName("body");if(msgBodies){for(var i=0;i<msgBodies.length;i++){var msgBody=msgBodies[i],childNodes=msgBody.childNodes;if(childNodes&&childNodes.length>0){var childNode=msgBody.childNodes[0];if(childNode.nodeType==Strophe.ElementType.TEXT){var jsondata=childNode.wholeText||childNode.nodeValue;jsondata=jsondata.replace("\n","<br>");try{var data=eval("("+jsondata+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(e){}}}}var delayTags=msginfo.getElementsByTagName("delay");if(delayTags&&delayTags.length>0){var delayTag=delayTags[0],delayMsgTime=delayTag.getAttribute("stamp");delayMsgTime&&(parseMsgData.delayTimeStamp=delayMsgTime)}}else{var childrens=msginfo.childNodes;if(childrens&&childrens.length>0){var child=msginfo.childNodes[0];if(child.nodeType==Strophe.ElementType.TEXT)try{var data=eval("("+child.nodeValue+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(e){}}}return parseMsgData},_parseNameFromJidFn=function(e,t){t=t||"";var o=e,n=o.indexOf("_");n!==-1&&(o=o.substring(n+1));var i=o.indexOf("@"+t);return i!==-1&&(o=o.substring(0,i)),o},_parseFriend=function(e){var t=[],o=e.getElementsByTagName("item");if(o)for(var n=0;n<o.length;n++){var i=o[n],s=i.getAttribute("jid");if(s){var r=i.getAttribute("subscription"),a={subscription:r,jid:s},c=i.getAttribute("ask");c&&(a.ask=c);var d=i.getAttribute("name");if(d)a.name=d;else{var l=_parseNameFromJidFn(s);a.name=l}var p=[];Strophe.forEachChild(i,"group",function(e){p.push(Strophe.getText(e))}),a.groups=p,t.push(a)}}return t},_login=function(e,t){var o=e.access_token||"";if(""==o){_utils.stringify(e);return void t.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:e,xhr:xhr})}t.context.accessToken=e.access_token,t.context.accessTokenExpires=e.expires_in;var n=null;if(t.isOpening()&&t.context.stropheConn)n=t.context.stropheConn;else{if(t.isOpened()&&t.context.stropheConn)return;n=new Strophe.Connection(t.url,{inactivity:t.inactivity,maxRetries:t.maxRetries,pollingTime:t.pollingTime})}var i=function(e,o){_loginCallback(e,o,t)};t.context.stropheConn=n,t.route?n.connect(t.context.jid,"$t$"+o,i,t.wait,t.hold,t.route):n.connect(t.context.jid,"$t$"+o,i,t.wait,t.hold)},_parseMessageType=function(e){var t="normal",o=e.getElementsByTagName("received");if(o&&o.length>0&&"urn:xmpp:receipts"===o[0].namespaceURI)t="received";else{var n=e.getElementsByTagName("invite");n&&n.length>0&&(t="invite")}return t},_handleMessageQueue=function(e){for(var t in _msgHash)_msgHash.hasOwnProperty(t)&&_msgHash[t].send(e)},_loginCallback=function(e,t,o){if(e==Strophe.Status.CONNFAIL)o.onError({type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:t,reconnect:!0});else if(e==Strophe.Status.ATTACHED||e==Strophe.Status.CONNECTED){var n=function(e){var t=_parseMessageType(e);return"received"===t?(o.handleReceivedMessage(e),!0):"invite"===t?(o.handleInviteMessage(e),!0):(o.handleMessage(e),!0)},i=function(e){return o.handlePresence(e),!0},s=function(e){return o.handlePing(e),!0},r=function(e){return o.handleIq(e),!0};o.addHandler(n,null,"message",null,null,null),o.addHandler(i,null,"presence",null,null,null),o.addHandler(s,"urn:xmpp:ping","iq","get",null,null),o.addHandler(r,"jabber:iq:roster","iq","set",null,null),o.context.status=_code.STATUS_OPENED;var a=[_code.WEBIM_MESSAGE_REC_TEXT,_code.WEBIM_MESSAGE_REC_EMOJI];_utils.isCanDownLoadFile&&(a.push(_code.WEBIM_MESSAGE_REC_PHOTO),a.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE));var c=[_code.WEBIM_MESSAGE_SED_TEXT];_utils.isCanUploadFile&&(c.push(_code.WEBIM_MESSAGE_REC_PHOTO),c.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE)),o.notifyVersion(),o.retry&&_handleMessageQueue(o),o.heartBeat(),o.isAutoLogin&&o.setPresence(),o.onOpened({canReceive:a,canSend:c,accessToken:o.context.accessToken})}else e==Strophe.Status.DISCONNECTING?o.isOpened()&&(o.stopHeartBeat(),o.context.status=_code.STATUS_CLOSING,o.onError({type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:t,reconnect:!0})):e==Strophe.Status.DISCONNECTED?(o.context.status=_code.STATUS_CLOSED,o.clear(),o.onClosed()):e==Strophe.Status.AUTHFAIL?(o.onError({type:_code.WEBIM_CONNCTION_AUTH_ERROR}),o.clear()):e==Strophe.Status.ERROR&&o.onError({type:_code.WEBIM_CONNCTION_SERVER_ERROR})},_getJid=function(e,t){var o=e.toJid||"";if(""===o){var n=t.context.appKey||"",i=n+"_"+e.to+"@"+t.domain;e.resource&&(i=i+"/"+e.resource),o=i}return o},_validCheck=function(e,t){if(e=e||{},""==e.user)return t.onError({type:_code.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR}),!1;var o=e.user+""||"",n=e.appKey||"",i=n.split("#");if(2!==i.length)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var s=i[0],r=i[1];if(!s)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;if(!r)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=n+"_"+o.toLowerCase()+"@"+t.domain,c=e.resource||"webim";return t.isMultiLoginSessions&&(c+=o+(new Date).getTime()+Math.floor(1e6*Math.random().toFixed(6))),t.context.jid=a+"/"+c,t.context.userId=o,t.context.appKey=n,t.context.appName=r,t.context.orgName=s,!0},_getXmppUrl=function(e,t){if(/^(ws|http)s?:\/\/?/.test(e))return e;var o={prefix:"http",base:"://"+e,suffix:"/http-bind/"};return t&&_utils.isSupportWss?(o.prefix="wss",o.suffix="/ws/"):t?o.prefix="https":window.WebSocket&&(o.prefix="ws",o.suffix="/ws/"),o.prefix+o.base+o.suffix},connection=function e(t){if(!this instanceof e)return new e(t);var t=t||{};this.isMultiLoginSessions=t.isMultiLoginSessions||!1,this.wait=t.wait||30,this.retry=t.retry||!1,this.https=t.https||"https:"===location.protocol,this.url=_getXmppUrl(t.url,this.https),this.hold=t.hold||1,this.route=t.route||null,this.domain=t.domain||"easemob.com",this.inactivity=t.inactivity||30,this.heartBeatWait=t.heartBeatWait||6e4,this.maxRetries=t.maxRetries||5,this.isAutoLogin=t.isAutoLogin!==!1,this.pollingTime=t.pollingTime||800,this.stropheConn=!1,this.context={status:_code.STATUS_INIT}};connection.prototype.listen=function(e){e.url&&(this.url=_getXmppUrl(e.url,this.https)),this.onOpened=e.onOpened||_utils.emptyfn,this.onClosed=e.onClosed||_utils.emptyfn,this.onTextMessage=e.onTextMessage||_utils.emptyfn,this.onEmojiMessage=e.onEmojiMessage||_utils.emptyfn,this.onPictureMessage=e.onPictureMessage||_utils.emptyfn,this.onAudioMessage=e.onAudioMessage||_utils.emptyfn,this.onVideoMessage=e.onVideoMessage||_utils.emptyfn,this.onFileMessage=e.onFileMessage||_utils.emptyfn,this.onLocationMessage=e.onLocationMessage||_utils.emptyfn,this.onCmdMessage=e.onCmdMessage||_utils.emptyfn,this.onPresence=e.onPresence||_utils.emptyfn,this.onRoster=e.onRoster||_utils.emptyfn,this.onError=e.onError||_utils.emptyfn,this.onReceivedMessage=e.onReceivedMessage||_utils.emptyfn,this.onInviteMessage=e.onInviteMessage||_utils.emptyfn,this.onOffline=e.onOffline||_utils.emptyfn,this.onOnline=e.onOnline||_utils.emptyfn,_listenNetwork(this.onOnline,this.onOffline)},connection.prototype.heartBeat=function(){var e=this;if(!e.heartBeatID){var t={to:e.domain,type:"normal"};e.heartBeatID=setInterval(function(){e.sendHeartBeatMessage(t)},e.heartBeatWait)}},connection.prototype.sendHeartBeatMessage=function(e){var t={},o=_utils.stringify(t),n=$msg({to:e.to,type:e.type,id:this.getUniqueId(),xmlns:"jabber:client"}).c("body").t(o);this.sendCommand(n.tree())},connection.prototype.stopHeartBeat=function(){this.heartBeatID=clearInterval(this.heartBeatID)},connection.prototype.sendReceiptsMessage=function(e){var t=$msg({from:this.context.jid||"",to:this.domain,id:e.id||""}).c("received",{xmlns:"urn:xmpp:receipts",id:e.id||""});this.sendCommand(t.tree())},connection.prototype.open=function(e){var t=_validCheck(e,this);if(t){var o=this;if(!o.isOpening()&&!o.isOpened())if(e.accessToken)e.access_token=e.accessToken,_login(e,o);else{var n=e.apiUrl,i=this.context.userId,s=e.pwd||"",r=this.context.appName,a=this.context.orgName,c=function(e,t){o.context.status=_code.STATUS_DOLOGIN_IM,_login(e,o)},d=function(e,t,n){o.clear(),e.error&&e.error_description?o.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:e,xhr:t}):o.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:e,xhr:t})};this.context.status=_code.STATUS_DOLOGIN_USERGRID;var l={grant_type:"password",username:i,password:s},p=_utils.stringify(l),e={url:n+"/"+a+"/"+r+"/token",dataType:"json",data:p,success:c||_utils.emptyfn,error:d||_utils.emptyfn};_utils.ajax(e)}}},connection.prototype.attach=function(e){var t=_validCheck(e,this);if(t){e=e||{};var o=e.accessToken||"";if(""==o)return void this.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR});var n=e.sid||"";if(""===n)return void this.onError({type:_code.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR});var i=e.rid||"";if(""===i)return void this.onError({type:_code.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR});var s=new Strophe.Connection(this.url,{inactivity:this.inactivity,maxRetries:this.maxRetries,pollingTime:this.pollingTime});this.context.accessToken=o,this.context.stropheConn=s,this.context.status=_code.STATUS_DOLOGIN_IM;var r=this,a=function(e,t){_loginCallback(e,t,r)},c=this.context.jid,d=this.wait,l=this.hold,p=this.wind||5;s.attach(c,n,i,a,d,l,p)}},connection.prototype.close=function(){var e=this.context.status;e!=_code.STATUS_INIT&&(this.isClosed()||this.isClosing()||(this.stopHeartBeat(),this.context.status=_code.STATUS_CLOSING,this.context.stropheConn.disconnect()))},connection.prototype.addHandler=function(e,t,o,n,i,s,r){this.context.stropheConn.addHandler(e,t,o,n,i,s,r)},connection.prototype.notifyVersion=function(e,t){var o=(_getJid({},this),$iq({from:this.context.jid||"",to:this.domain,type:"result"}).c("query",{xmlns:"jabber:iq:version"}).c("name").t("easemob").up().c("version").t(_version).up().c("os").t("webim")),e=e||_utils.emptyfn,n=t||this.onError,i=function(e){n({type:_code.WEBIM_CONNCTION_NOTIFYVERSION_ERROR,data:e})};this.context.stropheConn.sendIQ(o.tree(),e,i)},connection.prototype.handlePresence=function(e){if(!this.isClosed()){var t=e.getAttribute("from")||"",o=e.getAttribute("to")||"",n=e.getAttribute("type")||"",i=e.getAttribute("presence_type")||"",s=_parseNameFromJidFn(t),r=_parseNameFromJidFn(o),a={from:s,to:r,fromJid:t,toJid:o,type:n,chatroom:!!e.getElementsByTagName("roomtype").length},c=e.getElementsByTagName("show");if(c&&c.length>0){var d=c[0];a.show=Strophe.getText(d)}var l=e.getElementsByTagName("status");if(l&&l.length>0){var p=l[0];a.status=Strophe.getText(p),a.code=p.getAttribute("code")}var u=e.getElementsByTagName("priority");if(u&&u.length>0){var _=u[0];a.priority=Strophe.getText(_)}var m=e.getElementsByTagName("error");if(m&&m.length>0){var m=m[0];a.error={code:m.getAttribute("code")}}var h=e.getElementsByTagName("destroy");if(h&&h.length>0){var h=h[0];a.destroy=!0;var f=h.getElementsByTagName("reason");f&&f.length>0&&(a.reason=Strophe.getText(f[0]))}if(a.chatroom){var y=t.slice(t.lastIndexOf("/")+1);y===this.context.userId&&(""!==a.type||a.code?"unavailable"!==i&&"unavailable"!==a.type||(a.status?110==a.code?a.type="leaveChatRoom":a.error&&406==a.error.code&&(a.type="reachChatRoomCapacity"):a.type="leaveChatRoom"):a.type="joinChatRoomSuccess")}else"unavailable"!==i&&"unavailable"!==n||(a.destroy?a.type="deleteGroupChat":307!=a.code&&321!=a.code||(a.type="leaveGroup"));this.onPresence(a,e)}},connection.prototype.handlePing=function(e){if(!this.isClosed()){var t=e.getAttribute("id"),o=e.getAttribute("from"),n=e.getAttribute("to"),i=$iq({from:n,to:o,id:t,type:"result"});this.sendCommand(i.tree())}},connection.prototype.handleIq=function(e){var t=e.getAttribute("id"),o=e.getAttribute("from")||"",n=(_parseNameFromJidFn(o),this.context.jid),i=(this.context.userId,$iq({type:"result",id:t,from:n}));this.sendCommand(i.tree());var s=e.getElementsByTagName("query");if(s&&s.length>0){var r=s[0],a=_parseFriend(r);this.onRoster(a)}return!0},connection.prototype.handleMessage=function(e){if(!this.isClosed()){var t=e.getAttribute("id")||"";this.sendReceiptsMessage({id:t});var o=_parseResponseMessage(e);if(o.errorMsg)return void this.handlePresence(e);var n=o.data;for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];if(s.from&&s.to){var r=(s.from+"").toLowerCase(),a=(s.to+"").toLowerCase(),c=s.ext||{},d="",l=e.getElementsByTagName("roomtype");d=l.length?l[0].getAttribute("type")||"chat":e.getAttribute("type")||"chat";var p=s.bodies;if(p&&0!=p.length){var u=s.bodies[0],_=u.type;try{switch(_){case"txt":var m=u.msg,h=_utils.parseTextMessage(m,WebIM.Emoji);if(h.isemoji){var s={id:t,type:d,from:r,to:a,delay:o.delayTimeStamp,data:h.body,ext:c};!s.delay&&delete s.delay,this.onEmojiMessage(s)}else{var s={id:t,type:d,from:r,to:a,delay:o.delayTimeStamp,data:m,ext:c};!s.delay&&delete s.delay,this.onTextMessage(s)}break;case"img":var f=0,y=0;u.size&&(f=u.size.width,y=u.size.height);var s={id:t,type:d,from:r,to:a,url:u.url,secret:u.secret,filename:u.filename,thumb:u.thumb,thumb_secret:u.thumb_secret,file_length:u.file_length||"",width:f,height:y,filetype:u.filetype||"",accessToken:this.context.accessToken||"",ext:c,delay:o.delayTimeStamp};!s.delay&&delete s.delay,this.onPictureMessage(s);break;case"audio":var s={id:t,type:d,from:r,to:a,url:u.url,secret:u.secret,filename:u.filename,length:u.length||"",file_length:u.file_length||"",filetype:u.filetype||"",accessToken:this.context.accessToken||"",ext:c,delay:o.delayTimeStamp};!s.delay&&delete s.delay,this.onAudioMessage(s);break;case"file":var s={id:t,type:d,from:r,to:a,url:u.url,secret:u.secret,filename:u.filename,file_length:u.file_length,accessToken:this.context.accessToken||"",ext:c,delay:o.delayTimeStamp};!s.delay&&delete s.delay,this.onFileMessage(s);break;case"loc":var s={id:t,type:d,from:r,to:a,addr:u.addr,lat:u.lat,lng:u.lng,ext:c,delay:o.delayTimeStamp};!s.delay&&delete s.dealy,this.onLocationMessage(s);break;case"video":var s={id:t,type:d,from:r,to:a,url:u.url,secret:u.secret,filename:u.filename,file_length:u.file_length,accessToken:this.context.accessToken||"",ext:c,delay:o.delayTimeStamp};!s.delay&&delete s.dealy,this.onVideoMessage(s);break;case"cmd":var s={id:t,from:r,to:a,action:u.action,ext:c,delay:o.delayTimeStamp};!s.delay&&delete s.dealy,this.onCmdMessage(s)}}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}}}}}},connection.prototype.handleReceivedMessage=function(e){try{this.onReceivedMessage(e)}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}var t,o,n=e.getElementsByTagName("received");if(n.length>0&&(t=n[0].childNodes&&n[0].childNodes.length>0?n[0].childNodes[0].nodeValue:n[0].innerHTML||n[0].innerText,o=n[0].getAttribute("mid")),_msgHash[t]){try{_msgHash[t].msg.success instanceof Function&&_msgHash[t].msg.success(t,o)}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}delete _msgHash[t]}},connection.prototype.handleInviteMessage=function(e){var t=null,o=e.getElementsByTagName("invite"),n=e.getAttribute("id")||"";if(this.sendReceiptsMessage({id:n}),o&&o.length>0){var i=o[0].getAttribute("from");t=_parseNameFromJidFn(i)}var s=e.getElementsByTagName("x"),r=null;if(s&&s.length>0)for(var a=0;a<s.length;a++)if("jabber:x:conference"===s[a].namespaceURI){var c=s[a].getAttribute("jid");r=_parseNameFromJidFn(c)}this.onInviteMessage({type:"invite",from:t,roomid:r})},connection.prototype.sendCommand=function(e,t){this.isOpened()?this.context.stropheConn.send(e):this.onError({type:_code.WEBIM_CONNCTION_DISCONNECTED,reconnect:!0})},connection.prototype.getUniqueId=function(e){var t=new Date,o=new Date(2010,1,1),n=t.getTime()-o.getTime(),i=parseInt(n).toString(16);return"string"==typeof e||"number"==typeof e?e+"_"+i:"WEBIM_"+i},connection.prototype.send=function(e){if("[object Object]"===Object.prototype.toString.call(e)){var t=this.context.appKey||"",o=t+"_"+e.to+"@"+this.domain;e.group&&(o=t+"_"+e.to+"@conference."+this.domain),e.resource&&(o=o+"/"+e.resource),e.toJid=o,e.id=e.id||this.getUniqueId(),_msgHash[e.id]=new _message(e),_msgHash[e.id].send(this)}else"string"==typeof e&&_msgHash[e]&&_msgHash[e].send(this)},connection.prototype.addRoster=function(e){var t=_getJid(e,this),o=e.name||"",n=e.groups||"",i=$iq({type:"set"});if(i.c("query",{xmlns:"jabber:iq:roster"}),i.c("item",{jid:t,name:o}),n)for(var s=0;s<n.length;s++)i.c("group").t(n[s]).up();var r=e.success||_utils.emptyfn,a=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(i.tree(),r,a)},connection.prototype.removeRoster=function(e){var t=_getJid(e,this),o=$iq({type:"set"}).c("query",{xmlns:"jabber:iq:roster"}).c("item",{jid:t,subscription:"remove"}),n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(o,n,i)},connection.prototype.getRoster=function(e){var t=$iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"}),e=e||{},o=e.success||this.onRoster,n=function(e){var t=[],n=e.getElementsByTagName("query");if(n&&n.length>0){var i=n[0];t=_parseFriend(i)}o(t,e)},i=e.error||this.onError,s=function(e){i({type:_code.WEBIM_CONNCTION_GETROSTER_ERROR,data:e})};this.isOpened()?this.context.stropheConn.sendIQ(t.tree(),n,s):i({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.subscribe=function(e){var t=_getJid(e,this),o=$pres({to:t,type:"subscribe"});e.message&&o.c("status").t(e.message).up(),e.nick&&o.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(e.nick),this.sendCommand(o.tree())},connection.prototype.subscribed=function(e){var t=_getJid(e,this),o=$pres({to:t,type:"subscribed"});e.message&&o.c("status").t(e.message).up(),this.sendCommand(o.tree())},connection.prototype.unsubscribe=function(e){var t=_getJid(e,this),o=$pres({to:t,type:"unsubscribe"});e.message&&o.c("status").t(e.message),this.sendCommand(o.tree())},connection.prototype.unsubscribed=function(e){var t=_getJid(e,this),o=$pres({to:t,type:"unsubscribed"});e.message&&o.c("status").t(e.message).up(),this.sendCommand(o.tree())},connection.prototype.createRoom=function(e){var t,o=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn;return t=$iq({to:e.rooomName,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this.context.stropheConn.sendIQ(t.tree(),o,n)},connection.prototype.join=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,o=t+"/"+this.context.userId,n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,s=function(e){i({type:_code.WEBIM_CONNCTION_JOINROOM_ERROR,data:e})},r=$pres({from:this.context.jid,to:o}).c("x",{xmlns:Strophe.NS.MUC});this.context.stropheConn.sendIQ(r.tree(),n,s)},connection.prototype.listRooms=function(e){var t=$iq({to:e.server||"conference."+this.domain,from:this.context.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),o=e.success||_utils.emptyfn,n=e.error||this.onError,i=function(e){var t=[];t=_parseRoom(e);try{o(t)}catch(e){n({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:e})}},s=e.error||_utils.emptyfn,r=function(e){s({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:e})};this.context.stropheConn.sendIQ(t.tree(),i,r)},connection.prototype.queryRoomMember=function(e){var t=(this.domain,[]),o=$iq({to:this.context.appKey+"_"+e.roomId+"@conference."+this.domain,type:"get"}).c("query",{xmlns:Strophe.NS.MUC+"#admin"}).c("item",{affiliation:"member"}),n=e.success||_utils.emptyfn,i=function(e){var o=e.getElementsByTagName("item");if(o)for(var i=0;i<o.length;i++){var s=o[i],r={jid:s.getAttribute("jid"),affiliation:"member"};t.push(r)}n(t)},s=e.error||_utils.emptyfn,r=function(e){s({type:_code.WEBIM_CONNCTION_GETROOMMEMBER_ERROR,data:e})};this.context.stropheConn.sendIQ(o.tree(),i,r)},connection.prototype.queryRoomInfo=function(e){var t=this.domain,o=$iq({to:this.context.appKey+"_"+e.roomId+"@conference."+t,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_INFO}),n=e.success||_utils.emptyfn,i=[],s=function(e){var o=e.getElementsByTagName("field");if(o)for(var s=0;s<o.length;s++){var r=o[s];if("owner"===r.getAttribute("label")){var a={jid:(r.textContent||r.text)+"@"+t,affiliation:"owner"};i.push(a)}}n(i)},r=e.error||_utils.emptyfn,a=function(e){r({type:_code.WEBIM_CONNCTION_GETROOMINFO_ERROR,data:e})};this.context.stropheConn.sendIQ(o.tree(),s,a)},connection.prototype.queryRoomOccupants=function(e){var t=e.success||_utils.emptyfn,o=function(e){var o=[];o=_parseRoomOccupants(e),t(o)},n=e.error||_utils.emptyfn,i=function(e){n({type:_code.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR,data:e})},s={xmlns:Strophe.NS.DISCO_ITEMS},r=$iq({from:this.context.jid,to:this.context.appKey+"_"+e.roomId+"@conference."+this.domain,type:"get"}).c("query",s);this.context.stropheConn.sendIQ(r.tree(),o,i)},connection.prototype.setUserSig=function(e){var t=$pres({xmlns:"jabber:client"});e=e||"",t.c("status").t(e),this.sendCommand(t.tree())},connection.prototype.setPresence=function(e,t){var o=$pres({xmlns:"jabber:client"});e&&(t?(o.c("show").t(e),o.up().c("status").t(t)):o.c("show").t(e)),this.sendCommand(o.tree())},connection.prototype.getPresence=function(){var e=$pres({xmlns:"jabber:client"});this.sendCommand(e.tree())},connection.prototype.ping=function(e){var e=e||{},t=_getJid(e,this),o=$iq({from:this.context.jid||"",to:t,type:"get"}).c("ping",{xmlns:"urn:xmpp:ping"}),n=e.success||_utils.emptyfn,i=e.error||this.onError,s=function(e){i({type:_code.WEBIM_CONNCTION_PING_ERROR,data:e})};this.isOpened()?this.context.stropheConn.sendIQ(o.tree(),n,s):i({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.isOpened=function(){return this.context.status==_code.STATUS_OPENED},connection.prototype.isOpening=function(){var e=this.context.status;return e==_code.STATUS_DOLOGIN_USERGRID||e==_code.STATUS_DOLOGIN_IM},connection.prototype.isClosing=function(){return this.context.status==_code.STATUS_CLOSING},connection.prototype.isClosed=function(){return this.context.status==_code.STATUS_CLOSED},connection.prototype.clear=function(){var e=this.context.appKey;this.context={status:_code.STATUS_INIT,appKey:e}},connection.prototype.getChatRooms=function(e){if(!_utils.isCanSetRequestHeader)return void t.onError({type:_code.WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR});var t=this,o=e.accessToken||this.context.accessToken;if(o){var n=e.apiUrl,i=this.context.appName,s=this.context.orgName;if(!i||!s)return void t.onError({type:_code.WEBIM_CONNCTION_AUTH_ERROR});var r=function(t,o){"function"==typeof e.success&&e.success(t)},a=function(e,o,n){e.error&&e.error_description&&t.onError({type:_code.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,msg:e.error_description,data:e,xhr:o})},c={url:n+"/"+s+"/"+i+"/chatrooms",dataType:"json",type:"get",headers:{Authorization:"Bearer "+o},success:r||_utils.emptyfn,error:a||_utils.emptyfn};_utils.ajax(c)}else t.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR})},connection.prototype.joinChatRoom=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,o=t+"/"+this.context.userId,n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,s=function(e){i({type:_code.WEBIM_CONNCTION_JOINCHATROOM_ERROR,data:e})},r=$pres({from:this.context.jid,to:o}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"member",role:"participant"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(r.tree(),n,s)},connection.prototype.quitChatRoom=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,o=t+"/"+this.context.userId,n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,s=function(e){i({type:_code.WEBIM_CONNCTION_QUITCHATROOM_ERROR,data:e})},r=$pres({from:this.context.jid,to:o,type:"unavailable"}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"none",role:"none"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(r.tree(),n,s)},window.WebIM="undefined"!=typeof WebIM?WebIM:{},WebIM.connection=connection,WebIM.utils=_utils,WebIM.statusCode=_code,WebIM.message=_msg.message}(window,void 0)},196:function(e,t){"use strict";!function(){var e=0,o=100,n=200,i=300,s=400;t.code={WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_OPEN_ERROR:e++,WEBIM_CONNCTION_AUTH_ERROR:e++,WEBIM_CONNCTION_OPEN_USERGRID_ERROR:e++,WEBIM_CONNCTION_ATTACH_ERROR:e++,WEBIM_CONNCTION_ATTACH_USERGRID_ERROR:e++,WEBIM_CONNCTION_REOPEN_ERROR:e++,WEBIM_CONNCTION_SERVER_CLOSE_ERROR:e++,WEBIM_CONNCTION_SERVER_ERROR:e++,WEBIM_CONNCTION_IQ_ERROR:e++,WEBIM_CONNCTION_PING_ERROR:e++,WEBIM_CONNCTION_NOTIFYVERSION_ERROR:e++,WEBIM_CONNCTION_GETROSTER_ERROR:e++,WEBIM_CONNCTION_CROSSDOMAIN_ERROR:e++,WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES:e++,WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR:e++,WEBIM_CONNCTION_DISCONNECTED:e++,WEBIM_CONNCTION_AJAX_ERROR:e++,WEBIM_CONNCTION_JOINROOM_ERROR:e++,WEBIM_CONNCTION_GETROOM_ERROR:e++,WEBIM_CONNCTION_GETROOMINFO_ERROR:e++,WEBIM_CONNCTION_GETROOMMEMBER_ERROR:e++,WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR:e++,WEBIM_CONNCTION_LOAD_CHATROOM_ERROR:e++,WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR:e++,WEBIM_CONNCTION_JOINCHATROOM_ERROR:e++,WEBIM_CONNCTION_QUITCHATROOM_ERROR:e++,WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_CALLBACK_INNER_ERROR:e++,WEBIM_UPLOADFILE_BROWSER_ERROR:o++,WEBIM_UPLOADFILE_ERROR:o++,WEBIM_UPLOADFILE_NO_LOGIN:o++,WEBIM_UPLOADFILE_NO_FILE:o++,WEBIM_DOWNLOADFILE_ERROR:n++,WEBIM_DOWNLOADFILE_NO_LOGIN:n++,WEBIM_DOWNLOADFILE_BROWSER_ERROR:n++,WEBIM_MESSAGE_REC_TEXT:i++,WEBIM_MESSAGE_REC_TEXT_ERROR:i++,WEBIM_MESSAGE_REC_EMOTION:i++,WEBIM_MESSAGE_REC_PHOTO:i++,WEBIM_MESSAGE_REC_AUDIO:i++,WEBIM_MESSAGE_REC_AUDIO_FILE:i++,WEBIM_MESSAGE_REC_VEDIO:i++,WEBIM_MESSAGE_REC_VEDIO_FILE:i++,WEBIM_MESSAGE_REC_FILE:i++,WEBIM_MESSAGE_SED_TEXT:i++,WEBIM_MESSAGE_SED_EMOTION:i++,WEBIM_MESSAGE_SED_PHOTO:i++,WEBIM_MESSAGE_SED_AUDIO:i++,WEBIM_MESSAGE_SED_AUDIO_FILE:i++,WEBIM_MESSAGE_SED_VEDIO:i++,WEBIM_MESSAGE_SED_VEDIO_FILE:i++,WEBIM_MESSAGE_SED_FILE:i++,STATUS_INIT:s++,STATUS_DOLOGIN_USERGRID:s++,STATUS_DOLOGIN_IM:s++,STATUS_OPENED:s++,STATUS_CLOSING:s++,STATUS_CLOSED:s++}}()},197:function(e,t,o){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e,i=function(){},s=o(196).code,r=function(){try{return new window.XMLHttpRequest}catch(e){return!1}},a=function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}},c=function(e){e=e||!0;var t=r()||a();if("withCredentials"in t)return t;if(!e)return t;if("undefined"==typeof window.XDomainRequest)return t;var o=new XDomainRequest;return o.readyState=0,o.status=100,o.onreadystatechange=i,o.onload=function(){o.readyState=4,o.status=200;var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false",e.loadXML(o.responseText),o.responseXML=e,o.response=o.responseText,o.onreadystatechange()},o.ontimeout=o.onerror=function(){o.readyState=4,o.status=500,o.onreadystatechange()},o},d=function(){if("ActiveXObject"in window)try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){return 0}else if(navigator.plugins&&navigator.plugins.length>0)return navigator.plugins["Shockwave Flash"];return 0}(),l=c(),p="undefined"!=typeof FormData,u="undefined"!=typeof Blob,_=l.setRequestHeader||!1,m=l.overrideMimeType||!1,h=_&&p,f=h||d,y=_&&(u||m),E={hasFormData:p,hasBlob:u,emptyfn:i,isCanSetRequestHeader:_,hasOverrideMimeType:m,isCanUploadFileAsync:h,isCanUploadFile:f,isCanDownLoadFile:y,isSupportWss:function(){var e=[/MQQBrowser[\/]5([.]\d+)?\sTBS/];if(!window.WebSocket)return!1;for(var t=window.navigator.userAgent,o=0,n=e.length;o<n;o++)if(e[o].test(t))return!1;return!0}(),getIEVersion:function(){var e,t=navigator.userAgent,o={4:8,5:9,6:10,7:11};return e=t.match(/MSIE (\d+)/i),e&&e[1]?+e[1]:(e=t.match(/Trident\/(\d+)/i),e&&e[1]?o[e[1]]||null:null)}(),stringify:function(e){if("undefined"!=typeof JSON&&JSON.stringify)return JSON.stringify(e);var t="",o=[],i=function e(i){var s=!1;"[object Array]"===Object.prototype.toString.call(i)?(o.push("]","["),s=!0):"[object Object]"===Object.prototype.toString.call(i)&&o.push("}","{");for(var r in i)"[object Null]"===Object.prototype.toString.call(i[r])?i[r]="null":"[object Undefined]"===Object.prototype.toString.call(i[r])&&(i[r]="undefined"),t+=i[r]&&"object"===n(i[r])?","+(s?"":'"'+r+'":'+(s?'"':""))+e(i[r]):',"'+(s?"":r+'":"')+i[r]+'"';return""!=t&&(t=t.slice(1)),o.pop()+t+o.pop()};return i(e)},registerUser:function(e){var t=e.orgName||"",o=e.appName||"",n=e.appKey||"",r=e.success||i,a=e.error||i;if(!t&&!o&&n){var c=n.split("#");2===c.length&&(t=c[0],o=c[1])}if(!t&&!o)return void a({type:s.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR});var d=e.https||d,l=e.apiUrl,p=l+"/"+t+"/"+o+"/users",u={username:e.username,password:e.password,nickname:e.nickname||""},_=E.stringify(u),e={url:p,dataType:"json",data:_,success:r,error:a};return E.ajax(e)},login:function(e){var e=e||{},t=e.success||i,o=e.error||i,n=e.appKey||"",r=n.split("#");if(2!==r.length)return o({type:s.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=r[0],c=r[1],d=d||e.https,l=e.user||"",p=e.pwd||"",u=e.apiUrl,_={grant_type:"password",username:l,password:p},m=E.stringify(_),e={url:u+"/"+a+"/"+c+"/token",dataType:"json",data:m,success:t,error:o};return E.ajax(e)},getFileUrl:function(e){var t={url:"",filename:"",filetype:"",data:""},o="string"==typeof e?document.getElementById(e):e;if(!E.isCanUploadFileAsync||!o)return t;try{if(window.URL.createObjectURL){var n=o.files;if(n.length>0){var i=n.item(0);t.data=i,t.url=window.URL.createObjectURL(i),t.filename=i.name||""}}else{var i=document.getElementById(e).value;t.url=i;var s=i.lastIndexOf("/"),r=i.lastIndexOf("\\"),a=Math.max(s,r);a<0?t.filename=i:t.filename=i.substring(a+1)}var c=t.filename.lastIndexOf(".");return c!=-1&&(t.filetype=t.filename.substring(c+1).toLowerCase()),t}catch(e){throw e}},getFileSize:function(e){var t=document.getElementById(e),o=0;if(t)if(t.files)t.files.length>0&&(o=t.files[0].size);else if(t.select&&"ActiveXObject"in window){t.select();var n=new ActiveXObject("Scripting.FileSystemObject"),t=n.GetFile(t.value);
o=t.Size}return o},hasFlash:d,trim:function(e){return e="string"==typeof e?e:"",e.trim?e.trim():e.replace(/^\s|\s$/g,"")},parseEmoji:function(e){if("undefined"==typeof WebIM.Emoji||"undefined"==typeof WebIM.Emoji.map)return e;var t=WebIM.Emoji;for(var o in t.map)if(t.map.hasOwnProperty(o))for(;e.indexOf(o)>-1;)e=e.replace(o,'<img class="emoji" src="'+t.path+t.map[o]+'" />');return e},parseLink:function(e){var t=/(https?\:\/\/|www\.)([a-zA-Z0-9-]+(\.[a-zA-Z0-9]+)+)(\:[0-9]{2,4})?\/?((\.[:_0-9a-zA-Z-]+)|[:_0-9a-zA-Z-]*\/?)*\??[:_#@*&%0-9a-zA-Z-\/=]*/gm,o=e.match(t),n=o&&o[0]?o[0]:"";if(o&&o.length){var i=/^https?:\/\//.test(n);e=e.replace(t,"<a href='"+(i?n:"//"+n)+"' target='_blank'>"+n+"</a>")}return e},parseJSON:function(e){if(window.JSON&&window.JSON.parse)return window.JSON.parse(e+"");var t,o=null,n=E.trim(e+"");return n&&!E.trim(n.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,function(e,n,i,s){return t&&n&&(o=0),0===o?e:(t=i||n,o+=!s-!i,"")}))?Function("return "+n)():Function("Invalid JSON: "+e)()},parseUploadResponse:function(e){return e.indexOf("callback")>-1?e.slice(9,-1):e},parseDownloadResponse:function(e){return e&&e.type&&"application/json"===e.type||0>Object.prototype.toString.call(e).indexOf("Blob")?this.url+"?token=":window.URL.createObjectURL(e)},uploadFile:function(t){var t=t||{};t.onFileUploadProgress=t.onFileUploadProgress||i,t.onFileUploadComplete=t.onFileUploadComplete||i,t.onFileUploadError=t.onFileUploadError||i,t.onFileUploadCanceled=t.onFileUploadCanceled||i;var o=t.accessToken||this.context.accessToken;if(!o)return void t.onFileUploadError({type:s.WEBIM_UPLOADFILE_NO_LOGIN,id:t.id});var n,r,a,c=t.appKey||this.context.appKey||"";if(c&&(a=c.split("#"),n=a[0],r=a[1]),!n&&!r)return void t.onFileUploadError({type:s.WEBIM_UPLOADFILE_ERROR,id:t.id});var d=t.apiUrl,l=d+"/"+n+"/"+r+"/chatfiles";if(!E.isCanUploadFileAsync)return void(E.hasFlash&&"function"==typeof t.flashUpload?t.flashUpload&&t.flashUpload(l,t):t.onFileUploadError({type:s.WEBIM_UPLOADFILE_BROWSER_ERROR,id:t.id}));var p=t.file.data?t.file.data.size:void 0;if(p>e)return void t.onFileUploadError({type:s.WEBIM_UPLOADFILE_ERROR,id:t.id});if(p<=0)return void t.onFileUploadError({type:s.WEBIM_UPLOADFILE_ERROR,id:t.id});var u=E.xmlrequest(),_=function(e){t.onFileUploadError({type:s.WEBIM_UPLOADFILE_ERROR,id:t.id,xhr:u})};u.upload&&u.upload.addEventListener("progress",t.onFileUploadProgress,!1),u.addEventListener?(u.addEventListener("abort",t.onFileUploadCanceled,!1),u.addEventListener("load",function(e){try{var o=E.parseJSON(u.responseText);try{t.onFileUploadComplete(o)}catch(e){t.onFileUploadError({type:s.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}}catch(e){t.onFileUploadError({type:s.WEBIM_UPLOADFILE_ERROR,data:u.responseText,id:t.id,xhr:u})}},!1),u.addEventListener("error",_,!1)):u.onreadystatechange&&(u.onreadystatechange=function(){if(4===u.readyState)if(200===ajax.status)try{var e=E.parseJSON(u.responseText);t.onFileUploadComplete(e)}catch(e){t.onFileUploadError({type:s.WEBIM_UPLOADFILE_ERROR,data:u.responseText,id:t.id,xhr:u})}else t.onFileUploadError({type:s.WEBIM_UPLOADFILE_ERROR,data:u.responseText,id:t.id,xhr:u});else u.abort(),t.onFileUploadCanceled()}),u.open("POST",l),u.setRequestHeader("restrict-access","true"),u.setRequestHeader("Accept","*/*"),u.setRequestHeader("Authorization","Bearer "+o);var m=new FormData;m.append("file",t.file.data),u.send(m)},download:function(e){e.onFileDownloadComplete=e.onFileDownloadComplete||i,e.onFileDownloadError=e.onFileDownloadError||i;var t=e.accessToken||this.context.accessToken;if(!t)return void e.onFileDownloadError({type:s.WEBIM_DOWNLOADFILE_NO_LOGIN,id:e.id});var o=function(t){e.onFileDownloadError({type:s.WEBIM_DOWNLOADFILE_ERROR,id:e.id,xhr:n})};if(!E.isCanDownLoadFile)return void e.onFileDownloadComplete();var n=E.xmlrequest();"addEventListener"in n?(n.addEventListener("load",function(t){e.onFileDownloadComplete(n.response,n)},!1),n.addEventListener("error",o,!1)):"onreadystatechange"in n&&(n.onreadystatechange=function(){4===n.readyState?200===ajax.status?e.onFileDownloadComplete(n.response,n):e.onFileDownloadError({type:s.WEBIM_DOWNLOADFILE_ERROR,id:e.id,xhr:n}):(n.abort(),e.onFileDownloadError({type:s.WEBIM_DOWNLOADFILE_ERROR,id:e.id,xhr:n}))});var r=e.method||"GET",a=e.responseType||"blob",c=e.mimeType||"text/plain; charset=x-user-defined";n.open(r,e.url),"undefined"!=typeof Blob?n.responseType=a:n.overrideMimeType(c);var d={"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream","share-secret":e.secret,Authorization:"Bearer "+t},l=e.headers||{};for(var p in l)d[p]=l[p];for(var p in d)d[p]&&n.setRequestHeader(p,d[p]);n.send(null)},parseTextMessage:function(e,t){if("string"==typeof e&&"undefined"!=typeof t){if("[object Object]"!==Object.prototype.toString.call(t))return{isemoji:!1,body:[{type:"txt",data:e}]};var o=e,n=[],i=/\[[^[\]]{2,3}\]/gm,s=o.match(i);if(!s||s.length<1)return{isemoji:!1,body:[{type:"txt",data:e}]};for(var r=!1,a=0;a<s.length;a++){var c=o.substring(0,o.indexOf(s[a])),d=WebIM.Emoji.map[s[a]];if(c&&n.push({type:"txt",data:c}),d){var l=WebIM.Emoji.map?WebIM.Emoji.path+d:null;l?(r=!0,n.push({type:"emoji",data:l})):n.push({type:"txt",data:s[a]});var p=o.indexOf(s[a])+s[a].length;o=o.substring(p)}else n.push({type:"txt",data:s[a]})}return o&&n.push({type:"txt",data:o}),r?{isemoji:r,body:n}:{isemoji:!1,body:[{type:"txt",data:e}]}}},xmlrequest:c,ajax:function(e){var t=e.dataType||"text",o=e.success||i,n=e.error||i,r=E.xmlrequest();r.onreadystatechange=function(){if(4===r.readyState){var e=r.status||0;if(200===e){try{switch(t){case"text":return void o(r.responseText);case"json":var i=E.parseJSON(r.responseText);return void o(i,r);case"xml":return void(r.responseXML&&r.responseXML.documentElement?o(r.responseXML.documentElement,r):n({type:s.WEBIM_CONNCTION_AJAX_ERROR,data:r.responseText}))}o(r.response||r.responseText,r)}catch(e){n({type:s.WEBIM_CONNCTION_AJAX_ERROR,data:e})}return}return void n({type:s.WEBIM_CONNCTION_AJAX_ERROR,data:r.responseText})}0===r.readyState&&n({type:s.WEBIM_CONNCTION_AJAX_ERROR,data:r.responseText})},e.responseType&&r.responseType&&(r.responseType=e.responseType),e.mimeType&&E.hasOverrideMimeType&&r.overrideMimeType(e.mimeType);var a=e.type||"POST",c=e.data||null,d="";if("get"===a.toLowerCase()&&c){for(var l in c)c.hasOwnProperty(l)&&(d+=l+"="+c[l]+"&");d=d?d.slice(0,-1):d,e.url+=(e.url.indexOf("?")>0?"&":"?")+(d?d+"&":d)+"_v="+(new Date).getTime(),c=null,d=null}if(r.open(a,e.url),E.isCanSetRequestHeader){var p=e.headers||{};for(var u in p)p.hasOwnProperty(u)&&r.setRequestHeader(u,p[u])}return r.send(c),r}};t.utils=E}()},198:function(e,t,o){"use strict";!function(){var e=o(197).utils,n=function e(t,o){return!this instanceof e?new e(t):(this._msg={},"function"==typeof e[t]&&(e[t].prototype.setGroup=this.setGroup,this._msg=new e[t](o)),this._msg)};n.prototype.setGroup=function(e){this.body.group=e},n.txt=function(e){this.id=e,this.type="txt",this.body={}},n.txt.prototype.set=function(e){this.value=e.msg,this.body={id:this.id,to:e.to,msg:this.value,type:this.type,roomType:e.roomType,ext:e.ext||{},success:e.success,fail:e.fail},!e.roomType&&delete this.body.roomType},n.cmd=function(e){this.id=e,this.type="cmd",this.body={}},n.cmd.prototype.set=function(e){this.value="",this.body={to:e.to,action:e.action,msg:this.value,type:this.type,roomType:e.roomType,ext:e.ext||{}},!e.roomType&&delete this.body.roomType},n.location=function(e){this.id=e,this.type="loc",this.body={}},n.location.prototype.set=function(e){this.body={to:e.to,type:this.type,roomType:e.roomType,addr:e.addr,lat:e.lat,lng:e.lng,ext:e.ext||{}}},n.img=function(e){this.id=e,this.type="img",this.body={}},n.img.prototype.set=function(t){t.file=t.file||e.getFileUrl(t.fileInputId),this.value=t.file,this.body={id:this.id,file:this.value,apiUrl:t.apiUrl,to:t.to,type:this.type,ext:t.ext||{},roomType:t.roomType,onFileUploadError:t.onFileUploadError,onFileUploadComplete:t.onFileUploadComplete,success:t.success,fail:t.fail,flashUpload:t.flashUpload,body:t.body},!t.roomType&&delete this.body.roomType},n.audio=function(e){this.id=e,this.type="audio",this.body={}},n.audio.prototype.set=function(t){t.file=t.file||e.getFileUrl(t.fileInputId),this.value=t.file,this.filename=t.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:t.apiUrl,to:t.to,type:this.type,ext:t.ext||{},length:t.length||0,roomType:t.roomType,file_length:t.file_length,onFileUploadError:t.onFileUploadError,onFileUploadComplete:t.onFileUploadComplete,success:t.success,fail:t.fail,flashUpload:t.flashUpload,body:t.body},!t.roomType&&delete this.body.roomType},n.file=function(e){this.id=e,this.type="file",this.body={}},n.file.prototype.set=function(t){t.file=t.file||e.getFileUrl(t.fileInputId),this.value=t.file,this.filename=t.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:t.apiUrl,to:t.to,type:this.type,ext:t.ext||{},roomType:t.roomType,onFileUploadError:t.onFileUploadError,onFileUploadComplete:t.onFileUploadComplete,success:t.success,fail:t.fail,flashUpload:t.flashUpload,body:t.body},!t.roomType&&delete this.body.roomType},n.video=function(e){},n.video.prototype.set=function(e){};var i=function e(t){return!this instanceof e?new e(t,conn):void(this.msg=t)};i.prototype.send=function(t){var o=this,n=function o(n){n.ext=n.ext||{},n.ext.weichat=n.ext.weichat||{},n.ext.weichat.originType=n.ext.weichat.originType||"webim";var i={from:t.context.userId||"",to:n.to,bodies:[n.body],ext:n.ext||{}},s=e.stringify(i),r=$msg({type:n.group||"chat",to:n.toJid,id:n.id,xmlns:"jabber:client"}).c("body").t(s);n.roomType&&r.up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"}),t.retry&&setTimeout(function(){"undefined"!=typeof _msgHash&&_msgHash[n.id]&&("undefined"==typeof _msgHash[n.id].timeout&&(_msgHash[n.id].timeout=2),0===_msgHash[n.id].timeout?(_msgHash[n.id].timeout=2,_msgHash[n.id].msg.fail instanceof Function&&_msgHash[n.id].msg.fail(n.id)):(_msgHash[n.id].timeout-=1,o(n)))},2e4),t.sendCommand(r.tree(),n.id)};if(o.msg.file){if(o.msg.body&&o.msg.body.url)return void n(o.msg);var i=o.msg.onFileUploadComplete,s=function(e){if(e.entities[0]["file-metadata"]){var t=e.entities[0]["file-metadata"]["content-length"];o.msg.file_length=t,o.msg.filetype=e.entities[0]["file-metadata"]["content-type"],t>204800&&(o.msg.thumbnail=!0)}o.msg.body={type:o.msg.type||"file",url:e.uri+"/"+e.entities[0].uuid,secret:e.entities[0]["share-secret"],filename:o.msg.file.filename||o.msg.filename,size:{width:o.msg.width||0,height:o.msg.height||0},length:o.msg.length||0,file_length:o.msg.file_length||0,filetype:o.msg.filetype},n(o.msg),i instanceof Function&&i(e,o.msg.id)};o.msg.onFileUploadComplete=s,e.uploadFile.call(t,o.msg)}else o.msg.body={type:"chat"===o.msg.type?"txt":o.msg.type,msg:o.msg.msg},"cmd"===o.msg.type?o.msg.body.action=o.msg.action:"loc"===o.msg.type&&(o.msg.body.addr=o.msg.addr,o.msg.body.lat=o.msg.lat,o.msg.body.lng=o.msg.lng),n(o.msg)},t._msg=i,t.message=n}()}});